<html>
<head>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <form id="myForm">
    <input id="name" placeholder="ชื่อ" />
    <input id="message" placeholder="ข้อความ" />
    <button type="submit">ส่ง</button>
  </form>

  <script>
   async function main() {
  await liff.init({ liffId: "2007514355-Jkv9GPl2" });

  if (!liff.isLoggedIn()) {
    liff.login(); // จะ redirect อัตโนมัติ
    return; // รอให้ login เสร็จก่อน
  }

  const profile = await liff.getProfile();
  const userId = profile.userId;

  document.getElementById("myForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = document.getElementById("name").value;
    const message = document.getElementById("message").value;

    await fetch("(submitForm(us-central1)): https://submitform-o6ve32s2qa-uc.a.run.app", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
        // ถ้า API ต้องใช้ access_token: ใส่เพิ่มตรงนี้
        // "Authorization": `Bearer ${liff.getAccessToken()}`
      },
      body: JSON.stringify({ userId, name, message }),
    });

    alert("ส่งข้อมูลเรียบร้อยแล้ว ✅");
    liff.closeWindow();
  });
}
main();

  </script>
</body>
</html>
